# Elasticsearch 性能优化

#### Elasticsearch 性能优化主要针对写入和检索方面的优化，另外性能优化需要从硬件、网络、ES本身的优化等方面入手

ES 性能优化衡量标准
- **硬件指标：CPU使用率、内存使用率、磁盘IO使用率**
- **ES 性能指标：响应时间、吞吐量、并发数、负载**
- **网络指标：网络延迟、带宽、网络吞吐量**


ES 写入优化
- **写入前，可调整副本为0("number_of_replicas":0)，写入完成后，再调回来**
- **使用自动生成_id方式(自定义需要先查看，多一次磁盘IO)**
- **写入前，可调整刷新频率为-1("refresh_interval":-1)，写入完成后，再调回来**
- **调整JVM堆内存中的索引缓冲区大小("indices.memory.index_buffer_size":20%)，默认：10%**
- **批量写入_bulk**
- **多线程并发写入(logstash、spark都支持多线程写入)**
- **合理设置映射**
- **合理使用分词器**
- **使用SSD**
- **合理设置集群角色**
- **使用ES官方API**

ES 读取优化
- **避免返回全量数据(使用scroll api、search_after)**
- **避免使用大文档**
-  **设置合理的分片数、副本数**
- **合理使用写入预排序(创建索引时，将某个字段设置为正序、倒序)**
- **谨慎使用多表关联：join父子、nested嵌套文档**
- **避免检索全字段，可使用_source指定返回字段**
- **合理设置size值(使用scroll api、search_after)**
- **避免使用脚本**
- **多使用filter缓存机制**
- **避免使用通配符、正则匹配搜索**
- **避免使用全量聚合、多次聚合**

##### 至此，Elasticsearch 性能优化就介绍完成了，请开始你的表演吧！

&nbsp;

**有兴趣的小伙伴，可加联系方式：Telegram：@dean_code**
